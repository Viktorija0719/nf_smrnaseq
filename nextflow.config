/*
  RTU PBS/Torque + Singularity
  EDIT points are marked with  <<< EDIT
*/

profiles {
  rtu {
    process {
      executor       = 'pbs'
      queue          = 'batch'               // <<< EDIT default queue
      shell          = ['/bin/bash','-euo','pipefail']
      submitRateLimit = '10/1s'
      queueSize       = 60
      beforeScript = '''
        source /etc/profile.d/modules.sh
        module purge
        module load singularity/3.11.4      # <<< EDIT module name/version
        export SINGULARITY_CACHEDIR="${SINGULARITY_CACHEDIR:-$HOME/.singularity_cache}"  # <<< EDIT if you want a different cache path
        export APPTAINER_CACHEDIR="$SINGULARITY_CACHEDIR"
        export NXF_SINGULARITY_CACHEDIR="$SINGULARITY_CACHEDIR"
        export SINGULARITY_BINDPATH="/home,/scratch,/tmp"  # <<< EDIT binds to match your FS
        unset JAVA_HOME _JAVA_OPTIONS
        export SINGULARITYENV_JAVA_HOME=""
        export SINGULARITYENV__JAVA_OPTIONS=""
      '''
    }
  }
}

singularity {
  enabled    = true
  autoMounts = true
  runOptions = '--cleanenv'
  cacheDir   = "${System.getenv('SINGULARITY_CACHEDIR') ?: "$HOME/.singularity_cache"}"
}

workDir = "${System.getenv('NXF_WORK') ?: "$HOME/.nxf_work"}"   // <<< EDIT work dir if desired

// -------- central pipeline defaults (no duplication in run_work.sh) --------
params {
  // Small RNA specifics â€” change here once and forget:
  three_prime_adapter = 'TGGAATTCTCGGGTGCCAAGG'   // <<< EDIT if your adapter differs
  fastp_min_length  = 18                        // <<< EDIT if trimming policy differs
  fastp_max_length  = 30
  mirtrace_species  = 'hsa'                     // <<< EDIT species code (e.g., mmu, rno)
}

